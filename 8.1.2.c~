#include <stdio.h>
#include <sys/shm.h>
#include <sys/stat.h>

int main ()
{
  int i;
  int shm_id;
  char* shmaddr, *ptr;
  //char* shared_memory[3];
  char *p;

  key_t shm_key = /*ftok("hello.txt", 'r')*/6166529;
  const int shm_size = 10;

  /* Allocate a shared memory segment. */
  shm_id = shmget (shm_key, shm_size, IPC_CREAT | S_IRUSR | S_IWUSR);

  /* Attach the shared memory segment. */
  shmaddr = (char*) shmat (shm_id, 0, 0);

  printf ("shared memory attached at address %p\n", shmaddr);

  /* Start to read data. */
  p = (char*)shmaddr;
  for(i = 0; i < shm_size; i++) printf("%c\n", *p++);

  /* Detach the shared memory segment. */
  shmdt (shmaddr);
  return 0;
}
